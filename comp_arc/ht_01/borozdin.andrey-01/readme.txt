Добрый день!

Вот результат моих исследований в области сборки ассемблером простых программ под x86.

Что тут лежит:

hello_c - на С - не стал удалять
hello_syscall - с вызовом ядра
hello_puth_gcc - с вызовом puts, для сборки командой gcc
hello_puth_as_ld_linked_bad - с вызовом puts, для сборки командами as ld, плохо слинкованный
hello_puth_as_ld_linked_good - с вызовом puts, для сборки командами as ld, хорошо слинкованный

Вопросы:

1) syscall - тут все ясно, потому что ничего линковать не надо - все что надо заключено в самом файле ассемблера
В интернете все примеры относятся именно к этому примеру программы "hello world". На самом деле в данном случае мне пришлось сначала найти пример этой программы, а уже после понять что он именнотак и должен быть написан.

2) puts - тут возникли трудности. Прежде всего имеется существенная разница чем пользоваться - командой gcc или комаднами as и ld. Ассемблерный код должен быть разный - as хочет видеть _start, gcc хочет видеть main. Это можно понять.
Но далее трудности возникают при линковке.
2.1) До инструкции -lc пришлось догадаться.
2.2) При этом gcc - если дать ему одну команду - ничего на просит и все линкует сам и все ок, а при использовании as и ld - возникает вторая проблема - после команды:
	ld obj/hello_puts_as_ld.o -o bin/hello_puts_as_ld_link_good -lc
все делается без ошибок, но при попытке запуска я получаю:

	$ ~/csc/comp_arc/ht_01/task $ bin/hello_puts_as_ld_link_bad 
	bash: bin/hello_puts_as_ld_link_bad: No such file or directory

видимо что-то неправильно прилинковывается.
Тогда я запустил gcc с ключом -v и осмотрев на его строку параметров линковщика нашел там:

	-dynamic-linker /lib/ld-linux.so.2

Когда я добавил это к lc - все заработало.

Команда ldd дает такие выводы на плохо и хорошо слнкованном:

$ ~/csc/comp_arc/ht_01/task $ ldd bin/hello_puts_as_ld_link_bad

	linux-gate.so.1 =>  (0xb7732000)
	libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0xb756d000)
	/usr/lib/libc.so.1 => /lib/ld-linux.so.2 (0xb7733000)

$ ~/csc/comp_arc/ht_01/task $ ldd bin/hello_puts_as_ld_link_good

	linux-gate.so.1 =>  (0xb7796000)
	libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0xb75d1000)
	/lib/ld-linux.so.2 (0xb7797000)


Но мне осталось непонятно:
а) почему не работало?
б) как надо догадаться что именно это надо дописать?
в) может все-таки надо дописать что-то другое? Мне несколько не нравится что я привязываюсь к конкретной версии библиотеки.

г) выдайте мне еще задание на ассемблере, чтобы пришлось еще с чем-то поразбираться

С уважением,
Андрей Бороздин
